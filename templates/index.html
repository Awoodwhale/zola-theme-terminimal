{% import "macros/date.html" as date_macros -%}
{% import "macros/head.html" as head_macros -%}
{% import "macros/menu.html" as menu_macros -%}
{% import "macros/post.html" as post_macros -%}
{% import "macros/title.html" as title_macros -%}
{% import "macros/comment.html" as comment_macros -%}
{% import "macros/cdn.html" as cdn_macros -%}
{% import "macros/pjax.html" as pjax_macros -%}

<!DOCTYPE html>
<html lang="{%- if config.default_language -%}{{ config.default_language }}{%- else -%}en{%- endif -%}">

<head>
    <meta name="referrer" content="no-referrer"/>
    <title>{%- block title %}{{ config.title | safe }}{% endblock title -%}</title>
    {{ head_macros::head(config=config) }}

    {%- block open_graph %}{{ head_macros::open_graph(config=config) }}{% endblock open_graph -%}

    {%- if config.generate_feeds %}
        {%- for feed in config.feed_filenames %}
            {%- if feed is containing('atom') %}
                <link rel="alternate" type="application/atom+xml" title="{{ config.title }} Atom Feed" href="{{ get_url(path=feed, trailing_slash=false, lang=lang) | safe }}" />
            {%- endif %}

            {%- if feed is containing('rss') %}
                <link rel="alternate" type="application/rss+xml" title="{{ config.title }} RSS Feed" href="{{ get_url(path=feed, trailing_slash=false, lang=lang) | safe }}" />
            {%- endif %}

        {%- endfor %}
    {%- endif -%}

    {%- if config.extra.favicon %}
        <link rel="shortcut icon" type="{{ config.extra.favicon_mimetype | default(value="image/x-icon") | safe }}" href="{{ config.extra.favicon | safe }}">
    {% endif -%}

    {%- block extra_head %}
    {% if config.markdown.highlight_code and config.markdown.highlight_theme == "css" %}
        <link rel="stylesheet" type="text/css" href="/code-dark.css" media="(prefers-color-scheme: dark)" />
        <link rel="stylesheet" type="text/css" href="/code-light.css" media="(prefers-color-scheme: light)" />
    {% endif %}
    {{ cdn_macros::cdn() }}
    {% endblock extra_head -%}

</head>

<body class="">
<div class="container">
    {% block header %}
    <header class="header">
        <div class="header__inner">
            <div class="header__logo">
                {%- if config.extra.logo_home_link %}
                    {% set logo_link = config.extra.logo_home_link %}
                {% else %}
                    {% set logo_link = config.base_url %}
                {% endif -%}
                <a href="{{ logo_link | safe }}" style="text-decoration: none;">
                    <div class="logo">
                        {% block logo_content %}
                        {%- if config.extra.logo_text %}
                            {{ config.extra.logo_text }}
                        {% else %}
                            Terminimal theme
                        {% endif -%}
                        {% endblock logo_content %}
                    </div>
                </a>
            </div>
        </div>

        {% block header_menu %}
        {{ menu_macros::menu(config=config, current_path=current_path) }}
        {% endblock header_menu %}
    </header>
    {% endblock header %}

    <div class="toc-container"><div class="toc"></div></div>
    
    <div class="content">
        {% block content %}
        <div class="posts">
            {%- if paginator %}
                {%- set show_pages = paginator.pages -%}
            {% else %}
                {%- set show_pages = section.pages -%}
            {% endif -%}

            {%- for page in show_pages %}
                <div class="post on-list" style="margin: 15px auto;padding: 15px 0;">
                    {{ post_macros::header(page=page) }}

                    {{ post_macros::content(page=page, summary=true, show_only_description=page.extra.show_only_description | default(value=false)) }}
                </div>
            {% endfor -%}
            <div class="pagination">
                <div class="pagination__buttons">
                {%- if paginator and paginator.number_pagers and paginator.number_pagers > 1 and paginator.current_index > 1 %}
                    <span class="button first">
                        <a href="{{ paginator.first | safe }}">
                            <span class="button__icon">«</span>&nbsp;
                            <span class="button__text">First</span>
                        </a>
                    </span>
                {% endif -%}
                {%- if paginator.previous %}
                    <span class="button previous">
                        <a href="{{ paginator.previous | safe }}">
                            <span class="button__icon">←</span>&nbsp;
                            <span class="button__text">Prev</span>
                        </a>
                    </span>
                {% endif -%}
                {%- if paginator and paginator.number_pagers and paginator.number_pagers > 1 %}
                    {%- set total_pagers = paginator.number_pagers -%}
                    {%- set max_display = 5 -%}
                    {%- set start_page = paginator.current_index - 2 -%}
                    {%- if start_page < 1 -%}
                        {%- set start_page = 1 -%}
                    {%- endif -%}
                    {%- set end_page = start_page + max_display - 1 -%}
                    {%- if end_page > total_pagers -%}
                        {%- set end_page = total_pagers -%}
                        {%- set start_page = end_page - max_display + 1 -%}
                        {%- if start_page < 1 -%}
                            {%- set start_page = 1 -%}
                        {%- endif -%}
                    {%- endif -%}
                    <div class="pagination__pages" aria-label="Pagination">
                    {%- for page_number in range(start=start_page, end=end_page + 1) %}
                        {%- if page_number == 1 %}
                            {%- set page_link = paginator.first -%}
                        {% else %}
                            {%- set page_link = paginator.base_url ~ page_number ~ "/" -%}
                        {% endif -%}
                        {% if page_number == paginator.current_index %}
                            <span class="button page-number is-active" aria-current="page">
                                <span class="button__text">{{ page_number }}</span>
                            </span>
                        {% else %}
                            <span class="button page-number">
                                <a href="{{ page_link | safe }}" aria-label="{{ page_number }} page">
                                    <span class="button__text">{{ page_number }}</span>
                                </a>
                            </span>
                        {% endif -%}
                    {% endfor -%}
                    </div>
                {% endif -%}
                {%- if paginator.next %}
                    <span class="button next">
                        <a href="{{ paginator.next | safe }}">
                            <span class="button__text">Next</span>&nbsp;
                            <span class="button__icon">→</span>
                        </a>
                    </span>
                {% endif -%}
                {%- if paginator and paginator.number_pagers and paginator.number_pagers > 1 and paginator.current_index < paginator.number_pagers %}
                    <span class="button last">
                        <a href="{{ paginator.last | safe }}">
                            <span class="button__text">Last</span>&nbsp;
                            <span class="button__icon">»</span>
                        </a>
                    </span>
                {% endif -%}
                </div>
            </div>
        </div>
        {% endblock content %}
    </div>

    {% block footer %}
    <footer class="footer">
        <div class="footer__inner">
            {%- if config.extra.copyright_html %}
                <div class="copyright copyright--user">{{ config.extra.copyright_html | safe }}</div>
            {% else %}
                <div class="copyright">
                    {%- if config.extra.author %}
                        <span>© {{ date_macros::now_year() }} {{ config.extra.author }}</span>
                    {% else %}
                        <span>© {{ date_macros::now_year() }} Powered by <a href="https://www.getzola.org/">Zola</a></span>
                    {% endif -%}

                    <span class="copyright-theme">
                        <span class="copyright-theme-sep">:: </span>
                        Theme: <a href="https://github.com/pawroman/zola-theme-terminimal/">Terminimal</a> by pawroman
                    </span>
                </div>
            {% endif -%}
        </div>
        {{ pjax_macros::pjax() }}
    </footer>
    {% endblock footer %}

</div>

<button type="button" class="back-to-top" aria-label="Back to top">
    <span class="back-to-top__chevron" aria-hidden="true">
        <i class="fas fa-chevron-up"></i>
    </span>
</button>
{%- block extra_body %}
{% endblock extra_body -%}
</body>

</html>
